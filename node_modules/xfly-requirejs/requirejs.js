/**
 * @fileOverview 支持打包 AMD、CMD、CommonJS、BootJs为一个文件。
 */
var requirejs = require('requirejs');
require('tealweb-utils');

// TODO: extend this to send build log to grunt.log.ok / grunt.log.error
// by overriding the r.js logger (or submit issue to r.js to expand logging support)
requirejs.define('node/print', [], function () {
    return function print(msg) {
        if (msg.substring(0, 5) === 'Error') {
            xfly.error(msg);
        } else {
            xfly.log(msg);
        }
    };
});

module.exports = function (options) {
    options = Object.assign({}, options);
    return function (content, srcPath, destPath, xfly) {
       // exports.requirejs()
        return content;
    };
};

exports.requirejs = function (options, callback) {
    options.logLevel = xfly.verbose ? 0 : 2;
    requirejs.optimize(options, callback);
};
